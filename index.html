<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StoreConnect POS Actions 3.0</title>
    <style>
        body { margin: 0; padding: 0; font-family: 'Salesforce Sans', Arial, sans-serif; }
        #status { padding: 12px; margin: 12px; color: #444; background: #f3f3f3; border-radius: 4px; }
        #status.error { color: #b00020; background: #ffebee; }
        #lo2-container { width: 100%; min-height: 500px; }
    </style>
</head>
<body>
    <div id="status">Initializing Lightning Out 2.0...</div>
    <div id="lo2-container"></div>

    <!--<script src="https://warranty2amartfurniture--amartuat.sandbox.my.site.com/posactions/lightning/lightning.out.latest/index.iife.prod.js"></script>-->
    <script src="https://warranty2amartfurniture--amartuat.sandbox.my.salesforce.com/lightning/lightning.out.latest/index.iife.prod.js"></script>



    <script>
        (function() {
            const RAILWAY_PROXY = 'https://sc-auth-amart-production.up.railway.app';
            const statusEl = document.getElementById('status');
            const container = document.getElementById('lo2-container');

            function setStatus(msg, isError) {
                console.log(`[EC-LO2] ${msg}`);
                statusEl.textContent = msg;
                statusEl.className = isError ? 'error' : '';
            }

            async function init() {
                try {
                    setStatus('Fetching frontdoor URL...');
                    const resp = await fetch(`${RAILWAY_PROXY}/api/lo2/frontdoor`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ env: 'uat', appId: '1Us9n00000000mPCAQ' })
                    });
                    const data = await resp.json();
                    if (!resp.ok) throw new Error(data.error);

                    setStatus('Creating LO2 application...');
                    const lo2App = document.createElement('lightning-out-application');
                    lo2App.setAttribute('app-id', '1Us9n00000000mPCAQ');
                    lo2App.setAttribute('components', 'pos-actions-host-lwc');
                    lo2App.setAttribute('frontdoor-url', data.frontdoorUrl);

                    lo2App.addEventListener('applicationready', () => {
                        console.log('[EC-LO2] Application ready!');
                        setStatus('Application ready!');
                        const component = document.createElement('pos-actions-host-lwc');
                        container.appendChild(component);
                    });

                    lo2App.addEventListener('applicationerror', (e) => {
                        console.error('[EC-LO2] Error:', e.detail);
                        setStatus('Error: ' + (e.detail?.message || 'Unknown'), true);
                    });

                    container.appendChild(lo2App);
                    setStatus('Waiting for LO2...');
                } catch (err) {
                    console.error('[EC-LO2] Error:', err);
                    setStatus('Error: ' + err.message, true);
                }
            }

            init();
        })();
    </script>
</body>
</html>
